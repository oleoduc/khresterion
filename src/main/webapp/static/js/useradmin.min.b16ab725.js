var modUser=angular.module("admin.user",[]);modUser.factory("memberService",["$http",function(a){"use strict";return{getUser:function(b){return a.get("member?user_name="+b,{headers:{"Content-Type":"application/json","Cache-Control":"no-cache",Expires:0},timeout:0,cache:!1}).success(function(a,b,c,d){}).error(function(a,b,c,d){})},listAll:function(b,c){return a.get("member/list/all?page_number="+b+"&page_size="+c,{headers:{"Content-Type":"application/json","Cache-Control":"no-cache",Expires:0},timeout:0,cache:!1}).success(function(a,b,c,d){}).error(function(a,b,c,d){})},findBy:function(b,c){return a.get("member/list/by?user_lastname="+b+"&user_orga="+c,{headers:{"Content-Type":"application/json","Cache-Control":"no-cache",Expires:0},timeout:0,cache:!1}).success(function(a,b,c,d){}).error(function(a,b,c,d){})},createUser:function(b,c,d,e,f){return a.post("member",$.param({user_name:b,user_key:c,user_orga:d,user_firstname:e,user_lastname:f}),{headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache",Expires:0},timeout:0,cache:!1}).success(function(a,b,c,d){}).error(function(a,b,c,d){})},deleteUser:function(b){return a["delete"]("member?user_name="+b,{headers:{"Content-Type":"application/json","Cache-Control":"no-cache",Expires:0},timeout:0,cache:!1}).success(function(a,b,c,d){}).error(function(a,b,c,d){})},updateUSer:function(b,c,d,e){return a.post("member/update",$.param({user_name:b,user_orga:c,user_firstname:d,user_lastname:e}),{headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache",Expires:0},timeout:0,cache:!1}).success(function(a,b,c,d){}).error(function(a,b,c,d){})},setRole:function(b,c){return a.post("member/role/add",$.param({user_name:b,role_name:c}),{headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache",Expires:0},timeout:0,cache:!1}).success(function(a,b,c,d){}).error(function(a,b,c,d){})},removeRole:function(b,c){return a.post("member/role/remove",$.param({user_name:b,role_name:c}),{headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache",Expires:0},timeout:0,cache:!1}).success(function(a,b,c,d){}).error(function(a,b,c,d){})},setPassword:function(b,c){return a.post("member/password",$.param({user_name:b,user_key:c}),{headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache",Expires:0},timeout:0,cache:!1}).success(function(a,b,c,d){}).error(function(a,b,c,d){})},activate:function(b,c){return a.post("member/activate",$.param({user_name:b,active:c}),{headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache",Expires:0},timeout:0,cache:!1}).success(function(a,b,c,d){}).error(function(a,b,c,d){})}}}]),modUser.factory("roleService",["$http",function(a){"use strict";return{list:function(){return a.get("role/",{headers:{"Content-Type":"application/json","Cache-Control":"no-cache",Expires:0},timeout:0,cache:!1}).success(function(a,b,c,d){}).error(function(a,b,c,d){})}}}]);var userScreen=angular.module("userApp",["ngRoute","mm.foundation","admin.user"]).config(["$routeProvider","$locationProvider",function(a,b){"use strict";b.html5Mode(!1)}]);userScreen.controller("UserController",["$scope","$q","$timeout","$window","memberService","roleService",function(a,b,c,d,e,f){"use strict";a.errorBox=void 0,a.roleList=[],a.userList=[],a.predicate=void 0,a.reverse=!1,a.pageinfo={numberOfElements:0,totalElements:0,firstPage:!1,lastPage:!1,totalPages:0,size:0,number:0},a.pswdErrorMessage=null,a.cgpswdErrorMessage=null,a.errorBox=null,a.updrole=null,a.updusername=null;var g,h,i,j,k;h=function(){f.list().then(function(b){g=_.reject(b.data,function(a,b){return null===a.externalName}),a.roleList=_.sortBy(g,"externalName"),i(0,25)},function(b){a.errorBox=b.status})},i=function(b,c){e.listAll(b,c).then(function(b){a.userList=_.reject(b.data.content,function(a,b){return"root"===a.username}),a.pageinfo={numberOfElements:b.data.numberOfElements-1,totalElements:b.data.totalElements-1,firstPage:b.data.firstPage,lastPage:b.data.lastPage,totalPages:b.data.totalPages,size:b.data.size,number:b.data.number}},function(b){a.errorBox=b.status})},k=!1,a.createUser=function(){a.errorBox=null,k?e.createUser(a.username,a.password,a.organisation,a.firstname,a.lastname).then(function(b){a.errorBox=b.status,e.setRole(a.username,a.role.name).then(function(b){i(a.pageinfo.number,a.pageinfo.size)},function(b){a.errorBox="Création [OK]"})},function(b){a.errorBox=b.status}):a.errorBox="Confirmer mot de passe"},a.checkPassword=function(){a.pswdErrorMessage=null,k=!!a.password&&a.confirmpassword===a.password,k?a.pswdErrorMessage="Mot de passe [OK]":a.pswdErrorMessage="Le mot de passe ne correspond pas"},a.checkCGPassword=function(){a.cgpswdErrorMessage=null,k=!!a.cgpassword&&a.confirmcgpassword===a.cgpassword,k?a.cgpswdErrorMessage="Mot de passe [OK]":a.cgpswdErrorMessage="Le mot de passe ne correspond pas"},a.updateUser=function(){a.errorBox=null,e.updateUSer(a.username,a.organisation,a.firstname,a.lastname).then(function(b){a.errorBox=b.status,i(a.pageinfo.number,a.pageinfo.size)},function(b){a.errorBox=b.status})},a.resetPassword=function(){k?(a.errorBox=null,e.setPassword(a.cgusername,a.cgpassword).then(function(b){a.errorBox="Mis à jour [OK]"},function(b){a.errorBox="Echec mis à jour"})):a.errorBox="Confirmer mot de passe"},a.removeUser=function(b){a.errorBox="",e.deleteUser(b).then(function(b){a.errorBox=b.status,i(a.pageinfo.number,a.pageinfo.size)},function(b){a.errorBox=b.status})},a.activateUser=function(b,c){a.errorBox="",e.activate(b,c).then(function(b){a.errorBox=b.status,i(a.pageinfo.number,a.pageinfo.size)},function(b){a.errorBox=b.status})},a.modifyUser=function(b){a.cgusername=b.username,a.updusername=b.username,a.username=b.username,a.organisation=b.organisation,a.firstname=b.firstName,a.lastname=b.lastName,j=b.roleList.length>0?b.roleList[0].name:"ROLE_EXTERNAL"},j=null,a.changeRole=function(){a.errorBox=null,null!==j&&a.updrole?e.removeRole(a.updusername,j).then(function(b){e.setRole(a.updusername,a.updrole.name).then(function(b){j=null,a.updusername=null,i(a.pageinfo.number,a.pageinfo.size)},function(b){a.errorBox=b.status})},function(b){a.errorBox=b.status}):a.errorBox="Sélectionner utilisateur et un profil"},a.getNextTablePage=function(){var b;b=a.pageinfo.number+1,b>=a.pageinfo.totalPages&&(b=a.pageinfo.totalPages-1),i(b,a.pageinfo.size)},a.getPreviousTablePage=function(){var b;b=a.pageinfo.number-1,b<0&&(b=0),i(b,a.pageinfo.size)},a.getFirstTablePage=function(){i(0,a.pageinfo.size)},a.getLastTablePage=function(){i(a.pageinfo.totalPages-1,a.pageinfo.size)},h()}]);