var propertyMod=angular.module("kengine.property",["kengine.instance","kengine.reification"]);propertyMod.factory("propertyService",["$http","instanceManager","reificator",function(a,b,c){"use strict";var d;return d={update:function(d,e,f,g){var h;return h=b.resolveInstance(e),a.post("v2/property",$.param({instance_id:h.id,propertypath:f.propertypath,value:c.reifyToServer(f.value,f.valueType),envkey:h.envkey}),{headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache",Expires:0},timeout:0,cache:!1}).success(function(a,c,f,h){b.update(e,a),d.$emit(g,e)}).error(function(a,b,c,e){d.$emit("engineError",null)})},remove:function(c,d,e,f){var g;g=b.resolveInstance(d),a["delete"]("v2/property?instance_id="+g.id+"&envkey="+g.envkey+"&"+$.param({propertypath:e.propertypath}),{headers:{"Content-Type":"application/json","Cache-Control":"no-cache",Expires:0},timeout:0,cache:!1}).success(function(a,e,g,h){b.update(d,a),c.$emit(f,d)}).error(function(a,b,d,e){c.$emit("engineError",null)})},linkExisting:function(d,e,f,g){var h;return h=b.resolveInstance(e),a.post("v2/instance/"+h.id+"/link/existing",$.param({propertypath:f.propertypath,linked_id:c.reifyToServer(f.value,f.valueType),envkey:h.envkey}),{headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache",Expires:0},timeout:0,cache:!1}).success(function(a,c,f,h){b.update(e,a),d.$emit(g,e)}).error(function(a,b,c,e){d.$emit("engineError",null)})},include:function(c,d,e,f){var g;g=b.resolveInstance(d),a.post("v2/property/include",$.param({instance_id:g.id,envkey:g.envkey,propertypath:e.propertypath}),{headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache",Expires:0},timeout:0,cache:!1}).success(function(a,e,g,h){b.update(d,a),c.$emit(f,d)}).error(function(a,b,d,e){c.$emit("engineError",null)})},notinclude:function(c,d,e,f){var g;g=b.resolveInstance(d),a.post("v2/property/notinclude",$.param({instance_id:g.id,envkey:g.envkey,propertypath:e.propertypath}),{headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache",Expires:0},timeout:0,cache:!1}).success(function(a,e,g,h){b.update(d,a),c.$emit(f,d)}).error(function(a,b,d,e){c.$emit("engineError",null)})},exclude:function(c,d,e,f){var g;g=b.resolveInstance(d),a.post("v2/property/exclude",$.param({instance_id:g.id,envkey:g.envkey,propertypath:e.propertypath}),{headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache",Expires:0},timeout:0,cache:!1}).success(function(a,e,g,h){b.update(d,a),c.$emit(f,d)}).error(function(a,b,d,e){c.$emit("engineError",null)})},notexclude:function(c,d,e,f){var g;g=b.resolveInstance(d),a.post("v2/property/notexclude",$.param({instance_id:g.id,envkey:g.envkey,propertypath:e.propertypath}),{headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache",Expires:0},timeout:0,cache:!1}).success(function(a,e,g,h){b.update(d,a),c.$emit(f,d)}).error(function(a,b,d,e){c.$emit("engineError",null)})}}}]);var instMod=angular.module("kengine.instance",[]);instMod.factory("instanceManager",[function(){"use strict";var a;return a={map:[],update:function(a,b){var c;return c=this.resolveInstance(a),void 0!==c?(this.unRegister(a),this.register(a,b)):this.register(a,b),void 0!==c?c:void 0},register:function(a,b){var c;c=this.resolveInstance(a),void 0===c?this.map.push({key:a,value:b}):this.update(a,b)},unRegister:function(a){this.map=_.reject(this.map,function(b){return b.key===a})},resolveName:function(a){var b;return b=_.find(this.map,function(b){return b.id===a.id}),void 0!==b?b.key:void 0},resolveInstance:function(a){var b;return b=_.find(this.map,function(b){return b.key===a}),void 0!==b?b.value:void 0},clear:function(){this.map={}},adjustPropertypath:function(a,b){var c,d,e,f;for(d="/",c=a.split(d),e=b,f=1;f<c.length;f+=1)e+=d+c[f];return e},exportUrl:function(a,b,c){return void 0!==a?"v1/instance/"+a+"/export?template="+b+"&envkey="+c:null}}}]);var reifMod=angular.module("kengine.reification",[]);reifMod.factory("reificator",[function(){"use strict";var a,b;return b=function(a,b){if(null===a||void 0===a)return null;var c;return c=a.split(b),c[1]+b+c[0]+b+c[2]},a={reifyToServer:function(a,c){var d;return d=void 0===c?a:"Date"===c?new Date(b(a,"/")).getTime():"Integer"===c?parseInt(a,0):"Number"===c?parseFloat(a):"Boolean"===c?a:a},reifyFromServer:function(a,b){var c;return c=void 0===b?a:"Date"===b?null===a?null:new Date(parseInt(a,0)):"Integer"===b?null===a?null:parseInt(a,0):"Number"===b?null===a?null:parseFloat(a):"Boolean"===b?a:a},isPropertyEmpty:function(a){return void 0!==a.valueType&&("String"===a.valueType?null===a.value||""===a.value.trim():"Number"===a.valueType||"Integer"===a.valueType?null===a.value||void 0===a.value||""===a.value:null===a.value)},toUS:function(a,c){return b(a,c)}}}]);var mprogress=angular.module("modProgress",["mm.foundation"]);mprogress.factory("progressService",["$interval",function(a){"use strict";var b;return b={promise:{},start:function(b,c,d,e,f){b.pvalue=0,this.promise=a(function(){b.pvalue+e>100?(b.pvalue=0,b.firstMessage=f):b.pvalue=b.pvalue+e},c,d)},stop:function(b){a.cancel(this.promise),b.pvalue=100}}}]),mprogress.controller("CoProgressController",["$scope","progressService",function(a,b){"use strict";var c,d;d=this,(c=function(c,e,f,g){d.pvalue=c,a.$on(d.startEvent,function(a,c){b.start(d,e,f,g,d.secondMessage)}),a.$on(d.endEvent,function(a,c){b.stop(d)})})(2,200,100,2)}]),mprogress.directive("coProgress",[function(){"use strict";return{priority:0,restrict:"EA",replace:!0,transclude:!0,template:'<div ng-show="pro.isSaving"><div class="progresslayer"></div><div class="barlayer"><span>{{pro.firstMessage}} {{pro.pvalue}}%</span><div><div progressbar value="pro.pvalue" type="pro.type"><span class="meter">{{pro.pvalue}}%</span></div></div></div></div>',controller:"CoProgressController",controllerAs:"pro",bindToController:!0,scope:{pvalue:"@pvalue",type:"@type",firstMessage:"@",secondMessage:"@",startEvent:"@startEvent",endEvent:"@endEvent",isSaving:"="}}}]);var modSpinner=angular.module("modSpinner",[]);modSpinner.directive("coSpinner",[function(){"use strict";return{priority:0,restrict:"EA",replace:!0,transclude:!1,template:'<div ng-show="isLoading"><div class="spinner spinner-bar"></div></div>',scope:{isLoading:"="}}}]);var kbsimple=angular.module("modSimple",["kengine.property","ngSanitize"]);kbsimple.controller("StringController",["$scope","reificator","propertyService","$sce",function(a,b,c,d){"use strict";var e;e=this,e.trustedText=void 0,this.updateProperty=function(d){var f;void 0===e.property.value?f=!1:b.isPropertyEmpty(e.property)?(f=void 0!==d&&(13===d.keyCode||"blur"===d.type),f&&c.remove(a,e.bo,e.property,"entityChanged")):(f=void 0!==d&&(13===d.keyCode||"blur"===d.type||"click"===d.type),f?("1"===e.uppercase&&(e.property.value=e.property.value.toUpperCase()),c.update(a,e.bo,e.property,"entityChanged")):f=!1)}}]),kbsimple.directive("coSimple",[function(){"use strict";return{priority:0,restrict:"EA",replace:!0,transclude:!1,templateUrl:"views/partials/tpl/cosimple.html",controller:"StringController",controllerAs:"simple",bindToController:!0,scope:{property:"=property",bo:"@",textclass:"@",maxlength:"@",uppercase:"@"}}}]),kbsimple.directive("coString",[function(){"use strict";return{priority:0,restrict:"EA",replace:!0,transclude:!1,templateUrl:"views/partials/tpl/cosimple.html",controller:"StringController",controllerAs:"simple",bindToController:!0,scope:{property:"=property",bo:"@",textclass:"@",maxlength:"@",uppercase:"@"}}}]),kbsimple.directive("coClause",[function(){"use strict";return{priority:0,restrict:"EA",replace:!0,transclude:!1,templateUrl:"views/partials/tpl/coclause.html",controller:"StringController",controllerAs:"simple",bindToController:!0,scope:{property:"=property",bo:"@",textclass:"@",maxlength:"@",uppercase:"@"}}}]),kbsimple.directive("coNumber",[function(){"use strict";return{priority:0,restrict:"EA",replace:!0,transclude:!1,templateUrl:"views/partials/tpl/conumber.html",controller:"StringController",controllerAs:"simple",bindToController:!0,scope:{property:"=property",bo:"@",textclass:"@",maxlength:"@",uppercase:"@"}}}]),kbsimple.directive("coInteger",[function(){"use strict";return{priority:0,restrict:"EA",replace:!0,transclude:!1,templateUrl:"views/partials/tpl/cointeger.html",controller:"StringController",controllerAs:"simple",bindToController:!0,scope:{property:"=property",bo:"@",textclass:"@",maxlength:"@",uppercase:"@"}}}]),kbsimple.directive("coMessage",[function(){"use strict";return{priority:0,restrict:"EA",replace:!0,transclude:!1,templateUrl:"views/partials/tpl/comessage.html",scope:{property:"=property",bo:"@"}}}]),kbsimple.controller("ComboController",["$scope","reificator","propertyService",function(a,b,c){"use strict";var d;d=this,d.isVisible=!1,d.updateProperty=function(b){var e;e=!0,void 0===d.property.value?e=!1:e?c.update(a,d.bo,d.property,"entityChanged"):e=!1},d.applySelected=function(b,e){null!==b&&void 0!==b?d.property.value===b.value&&b.isIncluded?c.remove(a,d.bo,d.property,"entityChanged"):(d.property.value=b.value,c.update(a,d.bo,d.property,"entityChanged")):c.remove(a,d.bo,d.property,"entityChanged")}}]),kbsimple.directive("coCombobox",function(){"use strict";return{priority:1,restrict:"EA",replace:!0,controller:"ComboController",controllerAs:"vm",bindToController:!0,transclude:!1,templateUrl:"views/partials/tpl/colistbox.html",scope:{property:"=property",bo:"@",comboclass:"@"},link:{post:function(a,b,c){var d,e,f,g;d=angular.element(b).children(".combobase").children(".selectbox").children(".comboinput"),g=a.vm,e=function(){g.isVisible===!1?g.isVisible=!0:g.isVisible===!0?g.isVisible=!1:g.isVisible=!1,a.$digest()},f=function(){g.isVisible=!1,a.$digest()},d.children("button").first().on("click",e),d.children("input").first().on("click",e),angular.element(b).on("mouseleave",f)}}}}),kbsimple.controller("ComboInstanceController",["$scope","reificator","propertyService",function(a,b,c){"use strict";var d;d=this,d.isVisible=!1,d.applySelected=function(b,e){null!==b&&void 0!==b?d.property.value===b.value&&b.isIncluded?c.remove(a,d.bo,d.property,"entityChanged"):(d.property.value=b.value,c.linkExisting(a,d.bo,d.property,"entityChanged")):c.remove(a,d.bo,d.property,"entityChanged")}}]),kbsimple.directive("coInstancecombo",function(){"use strict";return{priority:1,restrict:"EA",replace:!0,controller:"ComboInstanceController",controllerAs:"vm",bindToController:!0,transclude:!1,templateUrl:"views/partials/tpl/corellistbox.html",scope:{property:"=property",bo:"@",comboclass:"@"},link:{post:function(a,b,c){var d,e,f,g;d=angular.element(b).children(".combobase").children(".selectbox").children(".comboinput"),g=a.vm,e=function(){g.isVisible===!1?g.isVisible=!0:g.isVisible===!0?g.isVisible=!1:g.isVisible=!1,a.$digest()},f=function(){g.isVisible=!1,a.$digest()},d.children("button").first().on("click",e),d.children("input").first().on("click",e),angular.element(b).on("mouseleave",f)}}}}),kbsimple.controller("EditableComboController",["$scope","reificator","propertyService",function(a,b,c){"use strict";var d;d=this,d.isVisible=!1,d.updateProperty=function(e){var f;void 0===d.property.value?f=!1:b.isPropertyEmpty(d.property)?(f=void 0!==e&&(13===e.keyCode||"blur"===e.type),f&&c.remove(a,d.bo,d.property,"entityChanged")):(f=void 0!==e&&(13===e.keyCode||"blur"===e.type||"click"===e.type),f?c.update(a,d.bo,d.property,"entityChanged"):f=!1)},d.applySelected=function(b,e){null!==b&&void 0!==b?d.property.value===b.value&&b.isIncluded?c.remove(a,d.bo,d.property,"entityChanged"):(d.property.value=b.value,c.update(a,d.bo,d.property,"entityChanged")):c.remove(a,d.bo,d.property,"entityChanged")}}]),kbsimple.directive("coComboboxEditable",function(){"use strict";return{priority:1,restrict:"EA",replace:!0,controller:"EditableComboController",controllerAs:"vm",bindToController:!0,transclude:!1,templateUrl:"views/partials/tpl/colistbox-editable.html",scope:{property:"=property",bo:"@",comboclass:"@"},link:{post:function(a,b,c){var d,e,f,g;d=angular.element(b).children(".combobase").children(".selectbox").children(".comboinput"),g=a.vm,e=function(){g.isVisible===!1?g.isVisible=!0:g.isVisible===!0?g.isVisible=!1:g.isVisible=!1,a.$digest()},f=function(){g.isVisible=!1,a.$digest()},d.children("button").first().on("click",e),d.children("input").first().on("click",e),angular.element(b).on("mouseleave",f)}}}}),kbsimple.directive("coTitle",function(){"use strict";return{priority:0,restrict:"EA",replace:!0,transclude:!1,template:"<span>{{property.label}}</span>",scope:{property:"=property",bo:"@"}}}),kbsimple.directive("coToggle",["propertyService","$timeout",function(a,b){"use strict";return{priority:0,restrict:"EA",replace:!0,transclude:!1,templateUrl:"views/partials/tpl/cotoggle.html",scope:{property:"=property",bo:"@"},link:{post:function(c,d,e){var f,g,h,i;f=function(){1===c.state0?(a.notinclude(c,c.bo,c.property,"entityChanged"),c.state0=0):(a.include(c,c.bo,c.property,"entityChanged"),c.state0=1)},g=function(){1===c.state1?(a.notexclude(c,c.bo,c.property,"entityChanged"),c.state1=0):(a.exclude(c,c.bo,c.property,"entityChanged"),c.state1=1)},h=function(a){null!==a&&void 0!==a&&(null!==a.isIncluded&&void 0!==a.isIncluded&&void 0!==a.isExcluded&&(c.property.isIncluded=a.isIncluded,c.property.isExcluded=a.isExcluded,c.state0=a.isIncluded?1:0,c.state1=a.isExcluded?1:0),c.$digest())},c.$parent.$watch(e.property,function(a,c){b(function(){h(a)},200)},!0),i=angular.element(d).children(".field-container"),i.children("input").first().on("click",f),i.children("input").first().next().on("click",g)}}}}]),kbsimple.controller("SectionLinkController",["$window","$http",function(a,b){"use strict";var c,d;c=this,d=document.getElementsByTagName("base")[0].href,c.openSection=function(){a.location.href=d+"etude/edit/section?section_id="+c.property.value+"&parent_id="+a.section_id+"&envkey="+a.envkey+"&path="+c.property.propertypath+"&plan_id="+a.plan_id},c.removeSection=function(){c.property.value?b["delete"](d+"/section?section_id="+c.property.value+"&parent_id="+a.section_id+"&envkey="+a.envkey,{headers:{"Content-Type":"application/json","Cache-Control":"no-cache",Expires:0},timeout:0,cache:!1}).success(function(a,b,d,e){console.log(a),c.property.value=null}).error(function(a,b,c,d){console.log(a)}):console.log("no instance")}}]),kbsimple.directive("coSectionlink",[function(){"use strict";return{priority:0,restrict:"EA",replace:!0,controller:"SectionLinkController",controllerAs:"sect",bindToController:!0,transclude:!1,templateUrl:"views/partials/tpl/sectionlink.html",scope:{property:"=property",bo:"@"}}}]),kbsimple.directive("coYesno",[function(){"use strict";return{priority:0,restrict:"EA",replace:!0,transclude:!1,templateUrl:"views/partials/tpl/coyesno.html",controller:"ComboController",controllerAs:"combo",bindToController:!0,scope:{property:"=property",bo:"@"}}}]);var kbdates=angular.module("modeDate",["kengine.property"]);kbdates.controller("DateCoherenceController",["$scope","reificator","propertyService",function(a,b,c){"use strict";var d,e;d=this,d.dateOptions={changeYear:!0,changeMonth:!0,maxDate:"+50Y",minDate:"-100Y"},d.isValid=!0,e=function(a){var c;return c=!1,c=null===a||void 0===a||(a.length<10||isNaN(new Date(b.toUS(a,"/")).getTime()))},d.updateProperty=function(b,f){var g;return g=!0,void 0===f||null===f?(g=!0,d.removeProperty()):""===f?(g=!0,d.removeProperty()):e(f)?g=!1:(g=void 0!==b&&(13===b.keyCode||"blur"===b.type),g&&(d.isValid=g,d.property.value=f,c.update(a,d.bo,d.property,"entityChanged"))),d.isValid=g,g},d.removeProperty=function(){"Entity"===d.property.valueType?c.remove(a,d.bo,d.property,"entityChanged"):c.remove(a,d.bo,d.property,"entityChanged")}}]),kbdates.directive("coDate",["$timeout","reificator",function(a,b){"use strict";return{priority:0,restrict:"EA",replace:!0,transclude:!1,templateUrl:"views/partials/tpl/codate.html",controller:"DateCoherenceController",controllerAs:"dtc",bindToController:!0,scope:{property:"=property",bo:"@"},link:{post:function(c,d,e){var f,g;g=c.dtc,f=function(){if(null!==g.property&&void 0!==g.property){var a,d;a=b.reifyFromServer(g.property.value,"Date"),void 0!==a&&null!==a?(d=a.getMonth()+1,c.dtime=(a.getDate()>=10?a.getDate():"0"+a.getDate())+"/"+(d>=10?d:"0"+d)+"/"+a.getFullYear()):g.dtime=null}else g.dtime=null;c.$digest()},c.$parent.$watch(e.property,function(b,c){a(function(){f()},500)},!0)}}}}]),angular.module("dueApp",["ngRoute","mm.foundation","modEtude","modSimple","modProgress"]).config(["$routeProvider","$locationProvider",function(a,b){b.html5Mode(!1)}]);var modEtude=angular.module("modEtude",[]);modEtude.controller("PlanListController",["$scope","$window","$http",function(a,b,c){"use strict";a.planList=[],a.isSearching=!0;var d,e;e=document.getElementsByTagName("base")[0].href,d=function(){c.get(e+"section/plan",{headers:{"Content-Type":"application/json","Cache-Control":"no-cache",Expires:0},timeout:0,cache:!1}).success(function(b,c,d,e){a.planList=_.sortBy(b,function(a){return a.id}),a.isSearching=!1}).error(function(b,c,d,e){console.log(b),a.isSearching=!1})},a.createPlan=function(d){a.isSearching=!0,c.post(e+"section/plan",{},{headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache",Expires:0},timeout:0,cache:!1}).success(function(c,d,f,g){console.log(c),a.isSearching=!1,b.location.href=e+"etude/edit/plan?envkey="+c+"&plan_id=0"}).error(function(b,c,d,e){console.log(b),a.isSearching=!1})},a.loadPlan=function(d){a.isSearching=!0,c.get(e+"section/plan/"+d,{headers:{"Content-Type":"application/json","Cache-Control":"no-cache",Expires:0},timeout:0,cache:!1}).success(function(c,f,g,h){console.log(c),a.isSearching=!1,b.location.href=e+"etude/edit/plan?envkey="+c+"&plan_id="+d}).error(function(b,c,d,e){console.log(b),a.isSearching=!1})},a.loadTreeview=function(d){a.isSearching=!0,c.get(e+"section/plan/"+d,{headers:{"Content-Type":"application/json","Cache-Control":"no-cache",Expires:0},timeout:0,cache:!1}).success(function(c,f,g,h){console.log(c),a.isSearching=!1,b.location.href=e+"etude/treeview?envkey="+c+"&plan_id="+d}).error(function(b,c,d,e){console.log(b),a.isSearching=!1})},d()}]),modEtude.controller("PlanViewController",["$scope","$window","$http","instanceManager",function(a,b,c,d){a.isSearching=!1,a.sectionList=[];var e,f;f="/due/",e=function(e){c.get(f+"v2/instance/search?envkey="+b.envkey+"&type_id=Ontologie1_Section0",{headers:{"Content-Type":"application/json","Cache-Control":"no-cache",Expires:0},timeout:0,cache:!1}).success(function(b,c,e,f){a.sectionList=_.sortBy(b,function(a){return a.label}),_.each(a.sectionList,function(a){d.register("Section"+a.id,a)}),a.isSearching=!1}).error(function(b,c,d,e){a.isSearching=!1,console.log(b)})},a.close=function(){a.isSearching=!0,c.get(f+"v2/environment/close?envkey="+b.envkey,{headers:{"Content-Type":"application/json","Cache-Control":"no-cache",Expires:0},timeout:0,cache:!1}).success(function(c,d,e,g){a.isSearching=!1,b.location.href=f+"etude/list/plan"}).error(function(b,c,d,e){a.isSearching=!1,console.log(b)})},a.save=function(){a.isSearching=!0,c.get(f+"etude/save/plan?envkey="+b.envkey,{headers:{"Content-Type":"application/json","Cache-Control":"no-cache",Expires:0},timeout:0,cache:!1}).success(function(c,d,e,g){a.isSearching=!1,b.location.href=f+"etude/list/plan"}).error(function(b,c,d,e){a.isSearching=!1,console.log(b)})},a.getProperty=function(a,b){var c;return c=d.resolveInstance("Section"+a),c?c.bo[b]:void 0},a.getInstanceName=function(a){return"Section"+a},a.reloadSections=function(){a.isSearching=!0,e(b.envkey)},e(b.envkey)}]);